---
title: "piru community plots"
author: "Shane Dewees"
date: "3/30/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(tidyverse)
library(lubridate)
```


Reading in data
```{r}
community_types <- read.csv(here("data", "community_types.csv"))
environmental_data <- read.csv(here("data", "par_soil_moisture.csv")) %>% 
  select(!community) %>% 
  full_join(community_types, join_by = "plot") %>% 
  mutate(date = mdy(date)) %>% 
  mutate(community = as.character(community))

#Coerced community to character so ggplot recognizes as discrete variable


```

Caluclate % of ambient par in plots
```{r}
environmental_data <- environmental_data %>% 
  mutate(par_prop = 100 - (par_plot / par_ambient) * 100)
```


Anova and Tukeys test to test for significance of soil moisture and %ambient par between communities
```{r}
date_key <- environmental_data %>% 
    group_by(date) %>% 
    summarise()

i <- 1

while(i <= nrow(date_key)){
  temp <- environmental_data %>% 
    filter(date == date_key$date[i])
    
  soil_moisture_anova <- aov(soil_moisture ~ factor(community), data = temp)
  soil_moisture_tukey <- TukeyHSD(soil_moisture_anova, conf.level = .95)
    
  par_prop_anova <- aov(par_prop ~ factor(community), data = temp)
  par_prop_tukey <- TukeyHSD(par_prop_anova, conf.level = .95)
    
  assign(paste("soil_moisture_anova", date_key$date[i], sep = "_"), soil_moisture_anova)
  assign(paste("soil_moisture_tukey", date_key$date[i], sep = "_"), soil_moisture_tukey)
   assign(paste("par_prop_anova", date_key$date[i], sep = "_"), par_prop_anova)
  assign(paste("par_prop_tukey", date_key$date[i], sep = "_"), par_prop_tukey)
  
  i = i + 1
}
  
rm(soil_moisture_anova)
rm(soil_moisture_tukey)
rm(par_prop_anova)
rm(par_prop_tukey)
rm(temp)
rm(i)
```

Make some ggplots of %ambient par and soil moisture to visualize data
```{r}
#Scatter plot of %ambient par vs soil moisture with color indicating community
ggplot(data = environmental_data) +
  geom_point(mapping = aes(x = par_prop, y = soil_moisture, color = community), alpha = .5) +
  geom_smooth(mapping = aes(x = par_prop, y = soil_moisture, color = community, fill = community), method = "lm", formula = y ~ x, alpha = .05) +
  theme_classic() +
  labs(caption = "Figure 1: Percent of ambient par blocked by plants versus soil moisture for three community types",
       x = "Percent of Ambient Par Blocked",
       y = "Soil Moisture",
       color = "Community Type:",
       fill = "") +
  guides(fill = FALSE) +
  theme(plot.caption = element_text(face = "bold", size = 11, hjust = 0),
        legend.position = "top",
        axis.title = element_text(size = 10),
        axis.text = element_text(size = 7))

#Jitter plot for soil moisture
ggplot(data = environmental_data) +
  geom_jitter(mapping = aes(x = community, y = soil_moisture), width = .2, alpha = .5, color = "blue") +
  theme_classic() +
  labs(caption = "Figure 2: Soil moisture across community types.",
       x = "Community Type",
       y = "Soil Moisture") +
  theme(plot.caption = element_text(face = "bold", size = 11, hjust = 0),
        legend.position = "top",
        axis.title = element_text(size = 10),
        axis.text = element_text(size = 7))

#Jitter plot for par_prop
ggplot(data = environmental_data) +
  geom_jitter(mapping = aes(x = community, y = par_prop), width = .2, alpha = .5, color = "orange") +
  theme_classic() +
  labs(caption = "Figure 3: Proportion of ambient PAR blocked across community types.",
       x = "Community Type",
       y = "Proportion of PAR Blocked") +
  theme(plot.caption = element_text(face = "bold", size = 11, hjust = 0),
        legend.position = "top",
        axis.title = element_text(size = 10),
        axis.text = element_text(size = 7))
```

